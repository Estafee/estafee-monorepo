generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  name          String
  role          String    @default("user") // "admin" | "user"
  
  // Profile & Branding
  address       String?
  phoneNumber   String?
  bio           String?
  avatarUrl     String?
  bannerUrl     String?
  isVerified    Boolean   @default(false)
  identityCard  String?   // URL foto KTP/Identitas
  balance       Decimal   @default(0)

  // Payment Info (Rekening Pencairan)
  bankName      String?
  bankAccount   String?
  bankHolder    String?

  // Relasi
  items           Item[]
  cart            CartItem[]
  rentalsAsLendee Rental[]  @relation("RentalsAsLendee")
  rentalsAsLender Rental[]  @relation("RentalsAsLender")
  reviewsWritten  Review[]  @relation("WrittenReviews")
  reviewsReceived Review[]  @relation("ReceivedReviews")

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Item {
  id              String    @id @default(uuid())
  title           String
  description     String    @db.Text
  pricePerDay     Decimal
  securityDeposit Decimal   @default(0)
  stock           Int       @default(1)
  images          String[]
  condition       String
  isAvailable     Boolean   @default(true)

  ownerId         String
  owner           User      @relation(fields: [ownerId], references: [id])

  categories      Category[]
  cartItems       CartItem[]
  rentalItems     RentalItem[]
  reviews         Review[]

  deletedAt       DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Category {
  id    String @id @default(uuid())
  name  String @unique
  slug  String @unique
  
  items Item[]
}

model CartItem {
  id        String   @id @default(uuid())
  quantity  Int
  startDate DateTime
  endDate   DateTime
  
  userId    String
  user      User     @relation(fields: [userId], references: [id])

  itemId    String
  item      Item     @relation(fields: [itemId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Rental {
  id              String    @id @default(uuid())
  status          String    @default("WAITING_APPROVAL")
  totalPrice      Decimal
  totalDeposit    Decimal
  shippingAddress String?
  rejectionReason String?
  
  startDate       DateTime
  endDate         DateTime
  confirmedAt     DateTime?
  returnedAt      DateTime?

  lendeeId        String
  lendee          User      @relation("RentalsAsLendee", fields: [lendeeId], references: [id])

  lenderId        String
  lender          User      @relation("RentalsAsLender", fields: [lenderId], references: [id])

  items           RentalItem[]
  review          Review?

  createdAt       DateTime  @default(now())
}

model RentalItem {
  id            String   @id @default(uuid())
  quantity      Int
  priceAtRental Decimal
  subtotal      Decimal

  rentalId      String
  rental        Rental   @relation(fields: [rentalId], references: [id])

  itemId        String
  item          Item     @relation(fields: [itemId], references: [id])
}

model Review {
  id           String   @id @default(uuid())
  rating       Int
  comment      String?
  
  reviewerId   String
  reviewer     User     @relation("WrittenReviews", fields: [reviewerId], references: [id])
  
  targetUserId String?
  targetUser   User?    @relation("ReceivedReviews", fields: [targetUserId], references: [id])

  itemId       String?
  item         Item?    @relation(fields: [itemId], references: [id])

  rentalId     String   @unique
  rental       Rental   @relation(fields: [rentalId], references: [id])

  createdAt    DateTime @default(now())
}